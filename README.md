# srp_python
An implementation of SRP in python, created to explore the algorithm for my final year project.

The implementation is derived from [RFC2945](https://www.rfc-editor.org/rfc/rfc2945) and [a paper on SRP](http://srp.stanford.edu/design.html).
It uses AES-GCM for passing encrypted messages once the key has been agreed.

## Usage:
Running the server:
```
DEBUG=3 python3 server.py
```

Registering a user:
```
# will prompt for username and pass
python3 client.py register --debug 3
```
 
Using SRP to negotiate a shared key and then encrypting a message between them.
```
# will prompt for username and pass
python3 client.py negotiate --debug 3
```                                

## Example:
Client output:
```py
srp_python on  main [!]
➜ ./client.py negotiate --user tritoke --passwd password --debug 3
[SRP.send_json] data = b'{"action": "negotiate", "username": "tritoke"}\n'
[SRP.recv_json] received = '{"success": false, "message": "Failed to find user in DB."}'
Caught exception: success = False - Failed to find user in DB.

srp_python on  main [!]
➜ ./client.py register --user tritoke --passwd password --debug 3
[SRP.send_json] data = b'{"action": "register", "username": "tritoke", "password": "password"}\n'
[SRP.recv_json] received = '{"success": true, "message": "Successfully registered user tritoke"}'
Successfully registered user tritoke

srp_python on  main [!]
➜ ./client.py negotiate --user tritoke --passwd password --debug 3
[SRP.send_json] data = b'{"action": "negotiate", "username": "tritoke"}\n'
[SRP.recv_json] received = '{"salt": 7708045301313568526}'
[SRP.send_json] data = b'{"user_public_ephemeral_key": 5539943874243244086133385194037172034807696775924507688012945904086043297688098996252188161882568198523714864143516808670906392461302511241273649189920109154918912944730737944309508887565668263452827709719974002558142975714815555802710333597152841254135453153284358151058959443142447037417861949188031766467733610159312595326492448817470941658806776406280255820198012212072446717466713954375923184267032035089841973042864650805248806110424087481850832243885981986924382933355201763865505958380667592155571608309774047528671883922829619607478387692342893206664657505586359178032187329989612091613540499794497559671890}\n'
[SRP.recv_json] received = '{"server_public_ephemeral_key": 39531855686537337563636669112799609960357208577162851382071959864130347108085440201385253182037314012382543738523169465823104553125139947977682135914232299671524431610194955226890929349853474988442717793727198672375541639385580247136159243471451939111589024211445551496670640172892915801341800262749258033299871310681551439172717415796030324673286882375009646843219646387825553749515815253414420539648609618568056271266013832446095673037673630591803135927361766698899211355573622282959114176106108854739200698980490012292214819515187120289472029013933355900569085698552576186131275335411370680148694816745769812270500}'
[SRP.send_json] data = b'{"verification_message": 16100868314146025395464126138853686651786509855127942079145256951596394853498}\n'
[SRP.recv_json] received = '{"verification_message": 66564005023429177862956291707115836968002493620360490811604641979771340251487}'
agreed shared key: 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000975A42B90506560D8E21551407141985A44CA32DC82E74E232F036814DFFF8F3
[SRP.recv_json] received = '{"success": true, "nonce": "x5dxkX0OVFmvuR1uk7/hYQ==", "enc_message": "9wXZBXCE4h8AVoiApDkRLgu02qVNeecmQxXDoJ40QXsa/2LiaL3ruYWepQ==", "tag": "saYJy2ln/F9Zh3SgeIjDdg=="}'
Received encrypted message: Successfully agreed shared key for tritoke.
```

Server output:
```py
srp_python on  main [!]
➜ DEBUG=3 ./server.py
[SRPHandler._recv_json()] received = '{"action": "negotiate", "username": "tritoke"}'
[SRPHandler._send_json()] data = b'{"success": false, "message": "Failed to find user in DB."}\n'
[SRPHandler._recv_json()] received = '{"action": "register", "username": "tritoke", "password": "password"}'
[SRPHandler._send_json()] data = b'{"success": true, "message": "Successfully registered user tritoke"}\n'
[SRPHandler._recv_json()] received = '{"action": "negotiate", "username": "tritoke"}'
[SRPHandler._send_json()] data = b'{"salt": 7708045301313568526}\n'
[SRPHandler._recv_json()] received = '{"user_public_ephemeral_key": 5539943874243244086133385194037172034807696775924507688012945904086043297688098996252188161882568198523714864143516808670906392461302511241273649189920109154918912944730737944309508887565668263452827709719974002558142975714815555802710333597152841254135453153284358151058959443142447037417861949188031766467733610159312595326492448817470941658806776406280255820198012212072446717466713954375923184267032035089841973042864650805248806110424087481850832243885981986924382933355201763865505958380667592155571608309774047528671883922829619607478387692342893206664657505586359178032187329989612091613540499794497559671890}'
[SRPHandler._send_json()] data = b'{"server_public_ephemeral_key": 39531855686537337563636669112799609960357208577162851382071959864130347108085440201385253182037314012382543738523169465823104553125139947977682135914232299671524431610194955226890929349853474988442717793727198672375541639385580247136159243471451939111589024211445551496670640172892915801341800262749258033299871310681551439172717415796030324673286882375009646843219646387825553749515815253414420539648609618568056271266013832446095673037673630591803135927361766698899211355573622282959114176106108854739200698980490012292214819515187120289472029013933355900569085698552576186131275335411370680148694816745769812270500}\n'
[SRPHandler._recv_json()] received = '{"verification_message": 16100868314146025395464126138853686651786509855127942079145256951596394853498}'
[SRPHandler._send_json()] data = b'{"verification_message": 66564005023429177862956291707115836968002493620360490811604641979771340251487}\n'
Derived K=975A42B90506560D8E21551407141985A44CA32DC82E74E232F036814DFFF8F3
[SRPHandler._send_json()] data = b'{"success": true, "nonce": "x5dxkX0OVFmvuR1uk7/hYQ==", "enc_message": "9wXZBXCE4h8AVoiApDkRLgu02qVNeecmQxXDoJ40QXsa/2LiaL3ruYWepQ==", "tag": "saYJy2ln/F9Zh3SgeIjDdg=="}\n'
```
