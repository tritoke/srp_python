# srp_python
An implementation of SRP in python, created to explore the algorithm for my final year project.

The implementation is derived from [RFC2945](https://www.rfc-editor.org/rfc/rfc2945) and [a paper on SRP](http://srp.stanford.edu/design.html).
It uses AES-GCM for passing encrypted messages once the key has been agreed.

## Usage:
Running the server:
```
DEBUG=3 python3 server.py
```

Registering a user:
```
# will prompt for username and pass
python3 client.py register --debug 3
```
 
Using SRP to negotiate a shared key and then encrypting a message between them.
```
# will prompt for username and pass
python3 client.py negotiate --debug 3
```                                

## Example:
Client output:
```py
srp_python on  main [!]
➜ ./client.py negotiate --user tritoke --passwd password --debug 3
[SRP.send_json] data = b'{"action": "negotiate", "username": "tritoke"}\n'
[SRP.recv_json] received = '{"success": false, "message": "Failed to find user in DB."}'
Caught exception: success = False - Failed to find user in DB.

srp_python on  main [!]
➜ ./client.py register --user tritoke --passwd password --debug 3
[SRP.send_json] data = b'{"action": "register", "username": "tritoke", "password": "password"}\n'
[SRP.recv_json] received = '{"success": true, "message": "Successfully registered user tritoke"}'
Successfully registered user tritoke

srp_python on  main [!]
➜ ./client.py negotiate --user tritoke --passwd password --debug 3
[SRP.send_json] data = b'{"action": "negotiate", "username": "tritoke"}\n'
[SRP.recv_json] received = '{"salt": 16301512958855019387}'
[SRP.send_json] data = b'{"user_public_ephemeral_key": 12112886964459085932924240499670463183772804032843652502492412517496150866891190578076437928245328980933893562297008486354099150625945275755632090128600723587993894733275592242523417914986999274682684154061953056238739249318267632940068970627817641274697506182855482984077737334585512214072391037617272945584653203657539783710412953646979581691069467293059929829223282100334451977733834658607997171446464903935047826770070747896147194345519592045944368627232567112732681151666935157083000722499522053123464779210858158476150507952117043172515152115169006472073674912830006109505648281947152908139103292984911408826399}\n'
[SRP.recv_json] received = '{"server_public_ephemeral_key": 37856584497979130237405102773308525180858919088188824194655116268941186592026580171230520478486572830723728115710260731998339436138939879540124596238162264062790986756036331632942680676292091658912994891759925594298775655982108232619636726001237464843311654473848586974696230301076442276317633897400121135045714855445061675792301487582650515441794194388231105856612653980073998212369587008813489383436728968152736534153849172603168392210340127768910203886381552629156470838533212919886897389733316189005652116778130127590058981737265853484457238432442721696833122413957653852373574568063473012111779730110002308563048}'
[SRP.send_json] data = b'{"verification_message": 49255416961228655828306719259016749018915328332281920628276797039620310563113}\n'
[SRP.recv_json] received = '{"verification_message": 98907715011686394211438667758786164772459094914044994964908854839178007912421}'
agreed shared key: EF898E1A67E5760A243DA01E53EF532156BBCEC6D676576318E1B5837D000B83
[SRP.recv_json] received = '{"success": true, "nonce": "zO+ZYoS7FvkLCj4T/ADWlQ==", "enc_message": "KEZ9ehdSNMBoIlnrzS+9ko2G5eXGAlex7f/o6Njt1ojXzdcoskGlNBTjYw==", "tag": "vX1g2byNvpmiVLuPYQ28Sg=="}'
Received encrypted message: Successfully agreed shared key for tritoke.
```

Server output:
```py
srp_python on  main [!]
➜ DEBUG=3 ./server.py
[SRPHandler._recv_json()] received = '{"action": "negotiate", "username": "tritoke"}'
[SRPHandler._send_json()] data = b'{"success": false, "message": "Failed to find user in DB."}\n'
[SRPHandler._recv_json()] received = '{"action": "register", "username": "tritoke", "password": "password"}'
[SRPHandler._send_json()] data = b'{"success": true, "message": "Successfully registered user tritoke"}\n'
[SRPHandler._recv_json()] received = '{"action": "negotiate", "username": "tritoke"}'
[SRPHandler._send_json()] data = b'{"salt": 16301512958855019387}\n'
[SRPHandler._recv_json()] received = '{"user_public_ephemeral_key": 12112886964459085932924240499670463183772804032843652502492412517496150866891190578076437928245328980933893562297008486354099150625945275755632090128600723587993894733275592242523417914986999274682684154061953056238739249318267632940068970627817641274697506182855482984077737334585512214072391037617272945584653203657539783710412953646979581691069467293059929829223282100334451977733834658607997171446464903935047826770070747896147194345519592045944368627232567112732681151666935157083000722499522053123464779210858158476150507952117043172515152115169006472073674912830006109505648281947152908139103292984911408826399}'
[SRPHandler._send_json()] data = b'{"server_public_ephemeral_key": 37856584497979130237405102773308525180858919088188824194655116268941186592026580171230520478486572830723728115710260731998339436138939879540124596238162264062790986756036331632942680676292091658912994891759925594298775655982108232619636726001237464843311654473848586974696230301076442276317633897400121135045714855445061675792301487582650515441794194388231105856612653980073998212369587008813489383436728968152736534153849172603168392210340127768910203886381552629156470838533212919886897389733316189005652116778130127590058981737265853484457238432442721696833122413957653852373574568063473012111779730110002308563048}\n'
[SRPHandler._recv_json()] received = '{"verification_message": 49255416961228655828306719259016749018915328332281920628276797039620310563113}'
[SRPHandler._send_json()] data = b'{"verification_message": 98907715011686394211438667758786164772459094914044994964908854839178007912421}\n'
Derived K=EF898E1A67E5760A243DA01E53EF532156BBCEC6D676576318E1B5837D000B83
[SRPHandler._send_json()] data = b'{"success": true, "nonce": "zO+ZYoS7FvkLCj4T/ADWlQ==", "enc_message": "KEZ9ehdSNMBoIlnrzS+9ko2G5eXGAlex7f/o6Njt1ojXzdcoskGlNBTjYw==", "tag": "vX1g2byNvpmiVLuPYQ28Sg=="}\n'
```
